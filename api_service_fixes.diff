// CHANGES NEEDED IN YOUR FLUTTER API SERVICE:

/*
1. UPDATE REGISTER METHOD:
*/
Future<Map<String, dynamic>> register({
  required String name,
  required String email,
  required String password,
  required String confirmPassword,
}) async {
  try {
    final response = await _dio.post(
      'auth/register/',
      data: {
        'name': name, // ← This should be 'email', 'password', 'first_name', 'last_name' for the register endpoint
        'email': email,
        'password': password,
        'confirm_password': confirmPassword,
      },
    );

    // ← FIX: Update to match actual response structure
    final data = response.data;
    if (data['access'] != null && data['refresh'] != null) { // ← UserSignupView doesn't return these
      // ← This won't work because UserSignupView doesn't return tokens
    }

    return {'success': true, 'data': response.data};
  } on DioException catch (e) {
    // ← FIX: Update error handling
    final errorMsg = (e.response?.data is Map)
        ? (e.response?.data['error'] ?? e.response?.data['detail'] ?? 'Registration failed')
        : 'Unexpected error: ${e.message}';
    return {'success': false, 'error': errorMsg};
  }
}

/*
2. UPDATE LOGIN METHOD:
*/
Future<Map<String, dynamic>> login({
  required String email,
  required String password,
}) async {
  try {
    final response = await _dio.post(
      'auth/login/',
      data: {
        'email': email,
        'password': password,
      },
    );

    // ← FIX: Update to match actual response structure
    if (response.statusCode == 200) {
      final data = response.data;
      await AuthService.saveAuthData(
        data['token'], // ← Changed from data['access'] to data['token']
        data['refresh'],
        data['user_id'].toString(), // ← Changed from data['user']['id'] to data['user_id']
      );
    }

    return {'success': true, 'data': response.data};
  } on DioException catch (e) {
    // ← FIX: Update error handling
    final errorMsg = (e.response?.data is Map)
        ? (e.response?.data['error'] ?? e.response?.data['detail'] ?? 'Login failed')
        : 'Unexpected error: ${e.message}';
    return {'success': false, 'error': errorMsg};
  }
}

/*
3. UPDATE SETUP PROFILE METHOD:
*/
Future<Map<String, dynamic>> setupProfile(
    Map<String, dynamic> profileData) async {
  try {
    final response = await _dio.post('auth/profile/setup/', data: profileData); // ← Fixed URL
    return {'success': true, 'data': response.data};
  } on DioException catch (e) {
    // ← FIX: Update error handling
    final errorMsg = (e.response?.data is Map)
        ? (e.response?.data['detail'] ?? 'Failed to setup profile')
        : 'Unexpected error: ${e.message} (Check if URL exists)';
    return {'success': false, 'error': errorMsg};
  }
}

/*
4. REMOVE OR UPDATE GET PROFILE METHODS:
The following endpoints don't exist in the current backend:
- auth/me/ 
- profile/

You should either:
1. Remove these methods, or
2. Update them to use existing endpoints like:
- For getting user info: Make a new endpoint or use the token to get user info
- For getting profile info: Use the profile setup endpoint with GET method (needs to be implemented)
*/

/*
5. UPDATE ERROR HANDLING CONSISTENTLY:
Throughout your code, change error handling from:
final errorMsg = (e.response?.data is Map)
    ? e.response?.data['detail'] ?? 'Registration failed'
    : 'Unexpected error: ${e.message}';

To:
final errorMsg = (e.response?.data is Map)
    ? (e.response?.data['error'] ?? e.response?.data['detail'] ?? 'Operation failed')
    : 'Unexpected error: ${e.message}';
*/